# Item 9. try-finally 보다는 try-with-resources를 사용하라

자바에서는 사용이 종료되면 close 등으로 특수한 처리를 필요로 하는 자원이 존재한다. Input / OutputStream, Connection 등이 대표적이다. 요즘이야 이런 걸 닫지 않으면 인텔리제이든 소나큐브든 온갖 코드 분석 도구들이 경고를 대신 뿌려주지만 예전에는 이런 실수를 저지르기 쉬웠나보다. 아무튼 이런 걸 닫아줄 때는 그냥 닫는게 아니라 예외가 발생하더라도 무조건 닫아주는 걸 보장하기 위해 try-finally 구문을 사용했다.

하지만 이런 방식은 이런저런 문제가 존재한다. 닫아야 하는 자원이 여러 개인 경우에 한 두개를 close 하는 것을 빼먹을 수 있다. 뿐만 아니라, `finally` 절에서도 추가적인 예외처리가 필요할 수 있다. 가령 뭔가 문제가 생겨서 커넥션을 끊어야 하는데, 커넧션을 끊는 과정에서 예외가 발생한다면? 중첩된 try-finally 구문을 사용해야 한다. 물론 코드가 상당히 더러워지기 때문에 일반적으로는 첫번째로 발생한 예외만 처리하긴 하지만 아무튼 마음에 들지 않는 것은 사실이다.

그래서 Java 7부터 try-with-resources 구문이 등장했다. 이 구문은 `AutoClosable` 인터페이스를 구현하는 클래스만 사용할 수 있다. 이 인터페이스는 `close()` 메서드를 정의하고 있으며, 이를 구현한 클래스는 try-with-resources 구문에서 사용될 수 있다. 이 구문을 사용하면 자원을 명시적으로 닫아주지 않아도 try 절이 끝나면 자동으로 닫아준다. 또한, try 절이 끝나면서 발생한 예외와 자원을 닫는 과정(기존의 finally 절에서)에서 발생한 예외를 모두 처리할 수 있다. 이를 "숨겨진 예외"라고 한다. 이것들도 스택 트레이스에 suppressed exception으로 출력된다.

결론이 뭐냐? 사용이 끝나면 닫아줘야 하는 자원이 있으면 AutoClosable 인터페이스를 구현하고, try-with-resources 구문을 사용하여 회수하자.
