# Item 17. 변경 가능성을 최소화하라

불변 클래스로 만들 수 있다면 되도록 그렇게 하는 편이 좋다. 객체의 생성부터 파괴까지 항상 같은 상태를 가지고 있기 때문에 이게 thread-safe할까? 에 대한 고민 없이 믿음을 가지고 쓸 수 있다. 어떻게 만들 수 있을까?

- setter를 제공하지 않는다.
- 상속을 막는다.
- 모든 필드를 final로 선언한다. (조금 더 명시적으로, 강력하게 제한할 수 있는 방법이다)
- 모든 필드를 private으로 선언한다. (외부에서 가변 객체를 참조하여 그 객체의 필드를 변경하는 것을 막는다)
- 가변 컴포넌트가 있다면 오로지 자기 자신만이 관리할 수 있게 한다 (해당 정보를 필요로 하는 클라이언트가 가변 컴포넌트를 변경시키지 않을 것이라고 무작정 신뢰하지 말자)

불변 객체를 사용했을 때의 장점은 이렇다.

- 불변 객체는 단순하다. 생성될 때 부여받은 한 가지 상태를 파괴될 때까지 그대로 간직한다.
- 불변 객체는 근본적으로 스레드 안전하여 따로 동기화할 필요가 없다.
- 불변 객체는 안심하고 공유할 수 있다.
- 객체를 만들 때 그 멤버로 불변 객체를 사용하면 좋다 (e.g. Value Object를 Record 클래스로 쓰는 경우)
- 실패 원자성을 제공 (생성자에서 검증 로직을 걸어두면 항상 일관된 상태를 가지거나 혹은 생성되지 않으므로, 이 객체가 일관되지 않은 상태를 가지고 있을까 걱정할 필요가 없다. e.g. EventPeriod 클래스)

단점도 있다.

값이 다르면 반드시 독립된 객체로 만들어야 한다. (e.g. BigInteger 클래스). 만약 여러 단계의 연산을 수행한다면 매 단계마다 새로운 객체가 만들어진다. 이때 연산 결과를 예측해서 최종 결과에 해당하는 객체를 바로 만들어낼 수 있다면 좋겠지만 그렇지 않다면 중간 단계의 객체들이 버려진다는 문제가 있다. 그냥 상태가 변하게 만드는 게 나을 수도 있다는 것.

상속을 막기 위해서는 final 클래스를 만들어도 되지만 생성자를 private로 선언하고 정적 팩토리 메서드를 사용하면 실질적인 final 클래스를 만들어낼 수 있다. 불변 객체라는 목적이 아니라도 객체의 생성 컨텍스트를 제한하고 싶은 경우 전체 생성자를 막고 정적 팩토리 메서드만을 오픈하는 것은 아주아주 좋은 방법이라 할 수 있다. 

불변 객체가 시사하는 점이 있다. 바로 getter와 setter를 쌍으로 만들 필요는 없다는 것이다. 불변 객체에 대해서 무지성으로 setter를 열어두게 되면 더 이상 불변 객체의 장점을 누릴 수 없게 된다. 클래스 설계 시 필요한 경우에만 setter을 열어두는 것이 좋다고 할 수 있다.

한편 당연한 말이지만 불변 객체에 대하여 생성자 혹은 생성자를 호출하는 정적 팩토리 메서드 외에는 상태를 바꾸거나 별도의 초기화 메서드가 존재해서는 안된다. 너무 당연한 말이라서 스킵하겠다...