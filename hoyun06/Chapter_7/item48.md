### Item48 : 스트림 병렬화는 주의해서 적용하라

###### parallel stream
자바 8에서는 stream을 제공하는데 여기에 parallel 메서드를 사용하면 스트림 파이프라인을 병렬적으로 처리할 수 있게 해준다.
개발자들은 당연히 여러 작업을 동시에 처리하면 성능 상의 이점을 챙길 수 있을 것이라 생각하고 parallel을 남용할 수 있는데 이는 
잘못된 생각이다.  
동시성 혹은 병렬적 프로그래밍을 할 때는 해당 코드의 안전성과 응답 가능성을 모두 고려해야 하는데 parallel 스트림 같은 경우 이 두 가지를 모두
만족하는 것이 쉽지만은 않다.

스트림의 경우 원본 원소 시퀸스가 Stream.iterate() 이거나 중간 연산으로 limit()를 사용한다면 parallel을 사용해도 성능 개선을
기대할 수 없다고 한다.

###### 그럼 parallel은 언제 사용하면 성능 개선이 있나요
스트림의 원본 원소 시퀸스가 `ArrayList`, `HashMap`, `HashSet`, `ConcurrentHashMap의` 인스턴스이거나 `배열`, `int 범위의 배열`, `long 범위의 배열`
의 경우에는 성능 개선을 기대해 볼 수 있다.  
위 자료구조들의 특징은 안에 있는 데이터들을 원하는 개수로 쪼개기 쉽다는 것이다. 그리고 위 자료구조 내부의 원소들은 참조 지역성이 좋아 참조 원소들이 메모리 공간에 연속적으로 존재한다.

하지만 참조 원소들이 연속적인 메모리 공간에 있더라도 실제 참조되는 인스턴스들이 서로 멀리 떨어져 있다면 병렬 스트림 파이프라인에서는 좋지 않다. 그래서 정말로 참조 지역성이 좋은
자료구조는 기본 타입이 들어있는 배열이다. 이 배열들은 정말로 원소들이 메모리 공간에 연속적으로 존재한다.

###### 스트림 파이프라인에서 병렬을 사용하는 경우 고려해야 하는 점
스트림 파이프라인에서는 종단 연산의 동작 방식이 성능에 큰 영향을 미친다.  
만약 종단 연산이 순차적이면서 전체 파이프라인에서 차지하는 비중이 높다면 이는 병렬을 이용하여 처리하기는 부적합한 스트림이다.  
반대로, 종단 연산이 스트림 제공 reduce 메서드 혹은 min, max, count, sum과 같이 모든 원소를 하나로 합치는 연산이라면 이는
병렬적으로 처리하기 적합하다.

###### 병렬을 남용할 경우 발생하는 문제점
병렬을 아무 생각없이 적용한다면 스트림 파이프라인의 결과에 문제가 발생할 수 있다. 당연히 성능이 나빠지는 것은 말할 것도 없고 해당 스트림을
병렬적으로 처리할 방법을 찾지 못해 응답 불가능한 상황이 발생할 수도 있다. 설령 응답을 할 순 있어도 결과로 받은 시퀸스가 제대로 수행된 연산의 결과임을 
보장할 수 없는 경우도 있을 수 있다.

###### 그럼 병렬은 사용하지 않는 것이 좋겠네요?
사실상 맞는 말이다. 왜냐하면 병렬을 사용했을 때 안전성이 보장되며 성능 상에서의 이점도 있는 경우가 그리 많지 않기 때문이다. 스트림 파이프라인에서
병렬을 사용하는 이유는 순전히 성능 최적화이므로 성능 상 이점이 없다면 굳이 사용할 필요가 없다. 저자는 스트림 파이프라인에 병렬을 도입했을 때 성능이 향상될지를 
추정할 수 있는 간단한 방법을 소개한다. 스트림 안의 원소 수와 원소당 수행되는 코드 줄 수를 곱해서 이 값이 최소 수십만은 되어야 성능 개선이 있다고 판단할 수 있다고 한다.

## 핵심 정리
    안전성이 보장되고 성능 개선이 확실한 상황에서만 parallel 스트림 파이프라인을 사용하자.

## 프로세스
흔히 프로그램과 프로세스라는 말을 혼용해서 사용하곤 한다. 혼용해서 사용해도 큰 상관은 없으나 그 의미 차이는 있다.
- 프로그램 : 실행할 수 있는 파일 개념이다. .exe 혹은 카카오톡과 같이 실행할 수 있는 파일들이 그 예이다. 다만, 실제로
실행 중인 단위가 아닌 정적인 파일 그 자체를 의미한다.
- 프로세스 : 운영체제에 의해 자원을 할당받고 그 자원을 이용하여 실제로 실행 중인 프로그램을 의미한다.

결국 프로그램과 프로세스 모두 코드 덩어리인 것은 맞지만 실질적인 자원 할당 여부 및 실행 여부에 따라 나뉜다고 생각하면 될 것 같다.

## 스레드
프로세스 내부에 존재하며 프로세스 실행 중에 진행해야 하는 작업을 처리할 수 있는 처리기 정도로 이해할 수 있을 것 같다.  
하나의 프로세스에는 최소 한 개의 스레드가 있으며 여러 개의 스레드가 있다면 여러 개의 작업을 동시에 처리할 수 있게 된다.