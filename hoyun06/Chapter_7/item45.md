### Item45 : 스트림은 주의해서 사용하라

###### 스트림 api
자바 8부터 다량의 데이터 처리 작업을 위해 `스트림 api`가 도입됐다.  
스트림 api 에서 나타내는 용어의 의미를 다음과 같이 이해하면 된다.  
- 스트림
  - 스트림이란 데이터 원소의 sequence인데 이때 데이터 원소의 수는 유한일 수도 있고 무한일 수도 있다
- 스트림 파이프
  - 스트림에 담긴 데이터 원소에 수행할 연산을 나타낸다

###### 스트림
- 스트림 안에 들어가는 데이터 원소들은 컬렉션, 배열, 파일, regex pattern matcher, 난수 생성기, 다른 스트림 등등으로부터 
가져올 수 있다.
- 스트림 안에 들어가는 데이터 원소들은 기본 타입 혹은 객체 참조이며 기본 타입의 경우 int, long, double을 기본 제공한다.

###### 스트림 파이프
- 스트림 파이프는 초기 스트림에서 시작해서 종단 연산(terminal operation)으로 끝나는데 그 사이에 하나 혹은 그 이상의 중간 연산(intermediate operation)으로 이뤄진다.
  - `중간 연산`은 해당 스트림을 변환하는데 해당 스트림의 각 원소에 특정 함수를 적용할 수도 있고 특정 조건을 만족하는 원소만 필터링할 수도 있다. 
  이때 중간 연산의 결과로 반환된 스트림의 원소들의 타입은 이전 스트림과 동일할 수도 있고 다를 수도 있다.
  - `종단 연산`은 마지막 중간 연산이 반환한 스트림에 최종 연산을 수행하고 그 결과를 반환한다. 이때 최종 연산이랑 정렬 후 리스트 반환 혹은 특정 원소 선택 반환과 같은 작업이 될 수 있다.
- 스트림 파이프라인은 `지연 평가(lazy evaluation)`된다. 그래서 종단 연산까지 연산을 미뤘다가 종단 연산을 만나는 순간 모든 연산을 실행한다. 그렇기 때문에 종단 연산에서 사용되지 않는다고
판단되는 원소에 대해선 아무런 연산도 진행하지 않고 배제하므로 위에서 언급한 '무한 데이터 원소 sequence'도 처리할 수 있는 것이다.
- 스트림 파이프라인은 기본적으론 순차적으로 실행되지만 parallel 이 붙은 메서드를 사용하면 병렬적으로 실행은 가능하다.

###### 스트림 사용 노하우
- 과도한 스트림 사용은 오히려 해가 된다
  - 스트림은 확실히 코드 길이를 줄여주므로 잘 사용만 한다면 가독성도 훨씬 올라간다. 하지만 너무 과도하게 사용하면 역효과가 발생할 수도 있다.
- char 값들을 처리할 때는 스트림 사용을 삼가는 것이 낫다
  - char 스트림을 반환받아 사용하려고 하면 내부 데이터 원소가 문자형이 아닌 정수형으로 반환되므로 오히려 혼란만 일으킬 확률이 높다.
- 모든 반복문을 스트림으로 리팩토링하지 말자
  - 첫 번째 노하우와 관련있는 내용이다. 가장 적합한 방법은 스트림과 반복문을 적당히 혼용하여 사용하는 것이다. 반복문을 스트림으로 변경하는 것은
  해당 반복문을 스트림으로 변경했을 때 성능면이나 가독성면에서 확실한 이점이 있을 때 하는 것이 좋다.
- 계산 로직에서 아래와 같은 연산을 해야 한다면 스트림을 사용해 보자
  - 원소들의 시퀀스를 일관되게 변환한다
  - 원소들의 시퀀스를 필터링한다
  - 원소들의 시퀀스를 하나의 연산을 사용해 결합한다 (덧셈, 연결, 최솟값 구하기...)
  - 원소들의 시퀀스를 컬렉션에 모은다
  - 원소들의 시퀀스에서 특정 조건을 만족하는 원소를 찾는다

###### 스트림으로 처리하기 어려운 작업
스트림에서는 중간 연산으로 인해 발생한 결과값에는 접근하기 어렵다는 단점이 있긴 하다. 즉, 특정 데이터 원소가 여러 스트림 연산을 거친다면 우리는 
종단 연산에서 반환받은 해당 데이터 원소의 최종값에만 접근할 수 있다는 뜻이다. 물론 map 같은 자료구조를 이용하여 값들을 매핑하여 저장할 순 있지만 
코드 분량이 늘어나고 그렇게 만족스럽진 않을 수 있다. 

## 핵심 정리
    반복문과 스트림에는 정답이 없다. 각각의 장점이 있으므로 상황에 맞게 사용하는 것이 좋다. 